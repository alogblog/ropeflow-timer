<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="data:image/png;base64,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">
    <link rel="stylesheet" href="ropeflow-styles.css" type="text/css" />
    <link rel="manifest" href="manifest.json">
    <title>RopeFlow Pro Timer</title>
    <script src="voices.js"></script>
    <script src="langs.js"></script>
    <script src="ui.js"></script>
</head>
<body>
    <!-- -------------------------------------------------------------------------- -->
    <!-- -------------------------------------------------------------------------- -->
    <!-- -------------------------------------------------------------------------- -->    
    <button id="settingsToggle" onclick="openSelectionPage()">âš™ï¸</button>

    <div id="selectionPage">
        <div class="modal-header">
            <div class="global-btns">
                <button onclick="globalSelect(true)" data-i18n="all"></button>
                <button onclick="globalSelect(false)" data-i18n="none"></button>
            </div>
            <button onclick="cancelSelection()" style="background: #555;" data-i18n="cancel"></button>
            <div id="selectedCount" style="font-size: 0.9rem; color: #aaa;"></div>
            <button class="done-btn" onclick="closeSelectionPage()" data-i18n="done"></button>
        </div>

        <div class="modal-body">
            <div class="sidebar" id="groupList"></div>
            <div class="content" id="moveList"></div>
        </div>
    </div>

    <!-- -------------------------------------------------------------------------- -->
    <!-- -------------------------------------------------------------------------- -->
    <!-- -------------------------------------------------------------------------- -->

    <div id="wordDisplay" data-i18n="ready" style="text-transform: uppercase;"></div>

    <div class="container">
        <div id="toggle-volume" style="text-align:center; margin-bottom:15px;">
            <span data-i18n="gap"></span>:<input type="number" id="gapInput"> 
            <span data-i18n="sec"></span>

<!--             <button id="toggle-volume999" style="background:none; border:none; cursor:pointer; 
            font-size:2rem;">ğŸ”½</button> -->
        </div>
        
        <div class="controls">
            <button id="setupBtn" data-i18n="shuffle_and_play"></button>
            <button id="playBtn" data-i18n="play_or_pause" disabled></button>
        </div>

        <div id="timeInfo">
            <span id="currentTime">00:00</span>
            <span id="totalTime">00:00</span>
        </div>

        <div id="volume-controls" class="volume-controls">
            <div class="volume-row">
                <span class="volume-label" data-i18n="voice"></span>
                <input type="range" id="voiceVol" min="0" max="1" step="0.01" value="1">
            </div>
            <div class="volume-row">
                <span class="volume-label" data-i18n="bg"></span>
                <input type="range" id="bgVol" min="0" max="1" step="0.01" value="0.5">
            </div>

            <hr style="border: 0; border-top: 1px solid #333; margin: 15px 0;">
            
            <div class="volume-row">
                <span class="volume-label" style="width: auto; flex-grow: 1;">ğŸ“± í™”ë©´ ì¼œì§ ìœ ì§€</span>
                <label class="switch">
                    <input type="checkbox" id="wakeLockTick">
                    <span class="slider-round"></span>
                </label>
            </div>

            <div class="volume-row">
                <span class="volume-label" style="width: auto; flex-grow: 1;">ğŸ”” <span id="label-text">50ë¶„ íœ´ì‹ ì•Œë¦¼</span></span>
                <span id="alarm-time" style="cursor: pointer; text-decoration: underline; font-weight: bold; color: #007bff; margin-right: 10px;">50</span>
                <label class="switch">
                    <input type="checkbox" id="breakNotifyTick">
                    <span class="slider-round"></span>
                </label>
            </div>            
        </div>

        <div id="status" data-i18n="status_info"></div>
    </div>

    <audio id="silentPlayer" loop style="display:none;"></audio>
    <audio id="bgMusicPlayer" src="./whip-afro-dancehall-music-110235.mp3" loop></audio>


<script>
const wordDisplay = document.getElementById('wordDisplay');
const setupBtn = document.getElementById('setupBtn');
const playBtn = document.getElementById('playBtn');
const statusDiv = document.getElementById('status');
const silentPlayer = document.getElementById('silentPlayer');
const gapInput = document.getElementById('gapInput');
const bgMusicPlayer = document.getElementById('bgMusicPlayer');
const bgVolumeSlider = document.getElementById('bgVol');
const voiceVolumeSlider = document.getElementById('voiceVol');
const alarmTimeSpan = document.getElementById('alarm-time');
const currentTimeSpan = document.getElementById('currentTime');
const totalTimeSpan = document.getElementById('totalTime');

const MOVES_IN_GROUP_DB = {};
const DEFAULT_GAP_TIME = 20;
const DEFAULT_VOICE_VOLUME = 1.0;
const DEFAULT_BG_VOLUME = 0.5;

let audioCtx = null;
let tickBuffer = null;
let decodedBuffersMap = {};
let shuffledWords = [];
let currentIndex = 0;
let currentSource = null;
let currentTickSource = null;
let isPlaying = false; // ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ true, ë£¨í‹´ì´ ì •ìƒì ìœ¼ë¡œ ëª¨ë‘ ì¬ìƒì™„ë£Œë˜ë©´ false.
let routineStartTime = 0; // ì „ì²´ ë£¨í‹´ ì‹œì‘ ì‹œê°„ (UI íƒ€ì´ë¨¸ìš©)
let totalDuration = 0;
let bgSource = null;
let bgGainNode = null; // ìŒì•… ë³¼ë¥¨ ì¡°ì ˆê¸°

// ì‚¬ìš©ìì˜ ì„ íƒ ìƒíƒœ ì €ì¥ (ê¸°ë³¸ê°’: ëª¨ë‘ ì„ íƒ)
let tempSelectedMoves = {}; // ì„¤ì •ì„ ìœ„í•œ ì„ì‹œ ì €ì¥ì†Œ
let selectedMoves = {};
let currentGroup = GR_DRAGON;
let gapTime = DEFAULT_GAP_TIME;

let bgVolume = DEFAULT_BG_VOLUME;    // ì´ˆê¸°ê°’
let voiceVolume = DEFAULT_VOICE_VOLUME; // ì´ˆê¸°ê°’
let mainVoiceGainNode = null; // ëª¨ë“  ìŒì„±(ìš´ë™ìŒ, í‹±)ì´ í†µê³¼í•  ê´€ë¬¸

async function initAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    if (Object.keys(decodedBuffersMap).length > 0) return;
    statusDiv.innerText = i18n['loading_sounds'];

    for (const [name, base64] of Object.entries(VOICE_ASSETS)) {
        //console.log(base64)
        const resp = await fetch(base64.data);
        const buffer = await audioCtx.decodeAudioData(await resp.arrayBuffer());
        if (name === 'tick') tickBuffer = buffer;
        else decodedBuffersMap[name] = buffer;
    }

    // ì´ë¯¸ ë§Œë“¤ì–´ì ¸ ìˆë‹¤ë©´ ì¬ì‚¬ìš©
    if (!mainVoiceGainNode) {
        mainVoiceGainNode = audioCtx.createGain();
        mainVoiceGainNode.gain.value = voiceVolume; // ë¡œë“œëœ ë³¼ë¥¨ê°’ ì ìš©
        mainVoiceGainNode.connect(audioCtx.destination);
    }
}

// ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ì— ë°°ê²½ìŒì•… ì—°ê²° (ì²˜ìŒ í•œ ë²ˆë§Œ ì‹¤í–‰)
function initBgMusic() {
    if (!audioCtx) return;

    // bgSourceê°€ ì´ë¯¸ ìˆë‹¤ëŠ” ê±´ ì´ë¯¸ ì—°ê²°ë˜ì–´ íë¥´ê³  ìˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
    if (!bgSource) {
        // 1. ìŒì•… ì†ŒìŠ¤ ìƒì„±
        bgSource = audioCtx.createMediaElementSource(bgMusicPlayer);
        // 2. ë³¼ë¥¨ ì¡°ì ˆ ë…¸ë“œ ìƒì„±
        bgGainNode = audioCtx.createGain();
        // 3. ì—°ê²°: ì†ŒìŠ¤ -> ë³¼ë¥¨ ë…¸ë“œ -> ìµœì¢… ì¶œë ¥
        bgSource.connect(bgGainNode);
        bgGainNode.connect(audioCtx.destination);
        
        // ì´ˆê¸° ë°°ê²½ ìŒì•… ë³¼ë¥¨ ì„¤ì • (ì˜ˆ: 50%)
        bgGainNode.gain.value = 0.8; 
        bgMusicPlayer.volume = 0.8; 
    }

    // ë§Œì•½ ìŒì•…ì´ ë©ˆì¶°ìˆì—ˆë‹¤ë©´(ì²« ì‹œì‘ ì‹œ) ì¬ìƒ, ì´ë¯¸ ë‚˜ì˜¤ê³  ìˆë‹¤ë©´ ì•„ë¬´ ì¼ë„ ì•ˆ í•¨
    if (bgMusicPlayer.paused) {
        bgMusicPlayer.play();
    }
}

gapInput.addEventListener('click', (e) => {
    e.stopPropagation();
    e.preventDefault();
});

gapInput.addEventListener('input', (e) => {
    gapTime = parseInt(e.target.value) || 0; // ìˆ«ìë¡œ ë³€í™˜
    localStorage.setItem('gapTime', gapTime);

    console.log('gapTime=' + gapTime);
});


// 4. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬// ë³¼ë¥¨ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
document.getElementById('voiceVol').addEventListener('input', (e) => {
    voiceVolume = parseFloat(e.target.value);
    // í•µì‹¬: ì´ë¯¸ ì¬ìƒ ì¤‘ì¸ ì†Œë¦¬ë“¤ë„ ì´ Nodeë¥¼ í†µê³¼í•˜ë¯€ë¡œ ì¦‰ì‹œ ì†Œë¦¬ê°€ ë³€í•©ë‹ˆë‹¤.
    if (mainVoiceGainNode) {
        mainVoiceGainNode.gain.setTargetAtTime(voiceVolume, audioCtx.currentTime, 0.05);
    }

    localStorage.setItem('ropeFlowVoiceVol', voiceVolume);
});

document.getElementById('bgVol').addEventListener('input', (e) => {
    bgVolume = parseFloat(e.target.value);
    if (bgGainNode) {
        // ë”í‚¹ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì¦‰ì‹œ ë°˜ì˜ë˜ë„ë¡ ë¡œì§ì„ ì§¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
        bgGainNode.gain.value = bgVolume; 
    }
    localStorage.setItem('ropeFlowBgVol', bgVolume);
});

setupBtn.onclick = async () => {
    playHaptic();
    setupBtn.disabled = true;

    // [ë³€ê²½] ì»¨í…ìŠ¤íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê³ , ê¸°ì¡´ ê²ƒì„ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    } else if (audioCtx.state === 'suspended') {
        await audioCtx.resume();
    }
    // 1. í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ëª¨ë“  ìš´ë™ ìŒì„±/í‹± ì†Œë¦¬ë§Œ ì¦‰ì‹œ ì¤‘ë‹¨
    stopVoiceAndTick(); 

    await initAudio();

    // ë¬´ìŒ ì˜¤ë””ì˜¤ ìœ„ì ¯ í™œì„±í™”
    const sampleRate = 8000;
    const dataSize = sampleRate * 600;
    const buffer = new ArrayBuffer(44 + dataSize);
    const view = new DataView(buffer);
    const writeString = (o, s) => { for (let i = 0; i < s.length; i++) view.setUint8(o + i, s.charCodeAt(i)); };
    writeString(0, 'RIFF'); view.setUint32(4, 36 + dataSize, true); writeString(8, 'WAVE'); writeString(12, 'fmt ');
    view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
    view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate, true);
    view.setUint16(32, 1, true); view.setUint16(34, 8, true); writeString(36, 'data');
    view.setUint32(40, dataSize, true);
    new Uint8Array(buffer, 44).fill(128);
    const blob = new Blob([buffer], { type: 'audio/wav' });
    if (silentPlayer.src) URL.revokeObjectURL(silentPlayer.src);
    silentPlayer.src = URL.createObjectURL(blob);

    // ì…”í”Œ ë° ì´ ì‹œê°„ ê³„ì‚°
    // if (shuffledWords.length == 0) {
    //     shuffledWords = Object.keys(decodedBuffersMap).sort(() => Math.random() - 0.5);
    // }
    // else {
    //     shuffledWords = [...shuffledWords].sort(() => Math.random() - 0.5);
    // }

    shuffledWords = [...shuffledWords].sort(() => Math.random() - 0.5);

    console.log(shuffledWords)
    console.log(shuffledWords.length)

    //const gap = parseInt(gapInput.value) || DEFAULT_GAP_TIME;
    totalDuration = shuffledWords.reduce((acc, w) => acc + decodedBuffersMap[w].duration, 0) + (gapTime * (shuffledWords.length - 1));
    totalTimeSpan.innerText = formatTime(totalDuration);

    isPlaying = true;
    routineStartTime = audioCtx.currentTime;

    // playBtn.click() ëŒ€ì‹  ì•„ë˜ì™€ ê°™ì´ ëª…ì‹œì ìœ¼ë¡œ ìƒíƒœë¥¼ ì¡ì•„ì¤ë‹ˆë‹¤.
    //await audioCtx.resume(); // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì¦‰ì‹œ ì¬ê°œ
    silentPlayer.play();     // ë¬´ìŒ í”Œë ˆì´ì–´ ì¦‰ì‹œ ì¬ìƒ
    initBgMusic(); // ë°°ê²½ìŒì•… ì—°ê²° í™•ì¸

    // ë¹ˆ ì†Œë¦¬ë¥¼ í•œ ë²ˆ ì¬ìƒí•´ì„œ ì˜¤ë””ì˜¤ í†µë¡œë¥¼ ëš«ì–´ì¤ë‹ˆë‹¤ (ì¤‘ìš”!)
    breakAudio.play().then(() => {
        breakAudio.pause();
        breakAudio.currentTime = 0;
    }).catch(e => console.log("Audio unlock failed"));
    //bgMusic.play(); 

    // 4. ìƒˆ ë£¨í‹´ ì‹œì‘ (ë°°ê²½ìŒì•…ì€ pause/play ì—†ì´ ê³„ì† íë¦„)
    playBtn.disabled = false;
    setupBtn.disabled = false;
    playBtn.innerText = i18n['pause']; // ë ˆì´ë¸” ê°•ì œ ê³ ì •
    if ('mediaSession' in navigator) {
        navigator.mediaSession.playbackState = "playing";
    }

    requestWakeLock();

    if (workoutStartTime == null) {
        startAlarm();
    }

    if (!startedProtection) startProtection();

    playExercise(0);
    requestAnimationFrame(updateUI);
};

playBtn.onclick = async (event) => {
    if (event && event.isTrusted) playHaptic();

    if (!audioCtx) return;

    //initBgMusic(); // ë°°ê²½ìŒì•… ì—°ê²° í™•ì¸

    if (audioCtx.state === 'running') {
    //if (playBtn.innerText === "ì¼ì‹œì¤‘ì§€") {
        // ì¼ì‹œì¤‘ì§€ ì‹¤í–‰
        await audioCtx.suspend();
        bgMusicPlayer.pause(); // ìš´ë™ ë©ˆì¶œ ë•Œ ìŒì•…ë„ ì •ì§€
        console.log("bg pause")
        silentPlayer.pause();
        playBtn.innerText = i18n['resume'];
        if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "paused";

        releaseWakeLock();
    } else {
        await audioCtx.resume();
        bgMusicPlayer.play(); // ìš´ë™ ì‹œì‘í•  ë•Œ ìŒì•…ë„ ì¬ìƒ
        console.log("bg play")
        // ì¬ìƒ ì‹¤í–‰
        silentPlayer.play();
        playBtn.innerText = i18n['pause'];
        if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "playing";

        requestWakeLock();
    }
    syncMediaPosition();
};


function applyDucking(isDucking) {
    if (!bgGainNode|| !audioCtx) return;

    const now = audioCtx.currentTime;
    if (isDucking) {
        // 0.2ì´ˆ ë™ì•ˆ ë³¼ë¥¨ì„ í˜„ì¬ ì„¤ì •ëœ ë°°ê²½ìŒ ë³¼ë¥¨ì˜ 20% ìˆ˜ì¤€ìœ¼ë¡œ ë‚®ì¶¤
        bgGainNode.gain.linearRampToValueAtTime(bgVolume * 0.2, now + 0.2);
    } else {
         // 0.5ì´ˆ ë™ì•ˆ,ì‚¬ìš©ìê°€ ìŠ¬ë¼ì´ë”ë¡œ ì„¤ì •í•´ë‘” ì›ë˜ ë³¼ë¥¨ìœ¼ë¡œ ë³µêµ¬
        bgGainNode.gain.linearRampToValueAtTime(bgVolume, now + 0.5);
    }
}

// í‹± ë²„í¼ ìƒì„±ê¸°
function _createTickBuffer(seconds) {
    const combined = audioCtx.createBuffer(1, audioCtx.sampleRate * seconds, audioCtx.sampleRate);
    const tickData = tickBuffer.getChannelData(0);
    const combinedData = combined.getChannelData(0);
    for (let i = 0; i < seconds; i++) combinedData.set(tickData, i * audioCtx.sampleRate);
    return combined;
}

function playGap() {
    const seconds = parseInt(gapInput.value) || DEFAULT_GAP_TIME;
    const source = audioCtx.createBufferSource();
    source.buffer = _createTickBuffer(seconds);

    source.connect(mainVoiceGainNode);
    currentTickSource = source;

    source.onended = () => { 
        if (isPlaying && currentTickSource === source) 
            playExercise(currentIndex + 1); 
    };
    source.start(0);
}

// ìš´ë™ ì´ë¦„ê³¼ tick ì†Œë¦¬ë¥¼ ë©ˆì¶¤.
function stopVoiceAndTick() {
    if (currentSource) { 
        currentSource.onended = null; 
        try { currentSource.stop(); } 
        catch(e){} currentSource = null; 
    }
    if (currentTickSource) { 
        currentTickSource.onended = null; 
        try { currentTickSource.stop(); 
        } catch(e){} 
        currentTickSource = null; 
    }
}

function adjustFontSize(word) {
    const len = word.length;
    let size = len <= 6 ? 5 : len <= 10 ? 4 : len <= 15 ? 3.3 : 2.6;
    wordDisplay.style.fontSize = size + "rem";
}

// ì¸ë±ìŠ¤ ê¸°ë°˜ ì¬ìƒ ì—”ì§„
async function playExercise(index) {
    if (index < 0) index = 0;
    if (index >= shuffledWords.length) { finishRoutine(); return; }

    currentIndex = index;
    const word = shuffledWords[currentIndex];
    
    // UI ì—…ë°ì´íŠ¸
    wordDisplay.innerText = word.toUpperCase();
    adjustFontSize(word);
    updateMediaMetadata(word.toUpperCase());
    statusDiv.innerText = `${currentIndex + 1} / ${shuffledWords.length} ` + i18n['steps'];

    // ì´ì „ ì†Œë¦¬ ì¤‘ë‹¨
    stopVoiceAndTick();

    // ë©˜íŠ¸ ì‹œì‘ ì „ ìŒì•… ë³¼ë¥¨ ë‚®ì¶”ê¸° (ë”í‚¹ ì‹œì‘)
    applyDucking(true);

    const source = audioCtx.createBufferSource();
    source.buffer = decodedBuffersMap[word];
    source.connect(mainVoiceGainNode);

    currentSource = source;

    source.onended = () => { 
        // ë©˜íŠ¸ê°€ ëë‚˜ë©´ ìŒì•… ë³¼ë¥¨ ë‹¤ì‹œ í‚¤ìš°ê¸° (ë”í‚¹ í•´ì œ)
        applyDucking(false);

        if (isPlaying && currentSource === source) playGap(); 
    };
    source.start(0);
    syncMediaPosition();
}

function updateMediaMetadata(word) {
    if ('mediaSession' in navigator) {
        navigator.mediaSession.metadata = new MediaMetadata({
            title: word, artist: 'RopeFlow Workout', artwork: [{ src: ARTWORK_BASE64, type: 'image/png' }]
        });
    }
}

function syncMediaPosition() {
    if ('mediaSession' in navigator && 'setPositionState' in navigator && routineStartTime !== 0) {
        const elapsed = audioCtx.currentTime - routineStartTime;
        navigator.mediaSession.setPositionState({
            duration: totalDuration,
            playbackRate: audioCtx.state === 'running' ? 1 : 0,
            position: Math.min(Math.max(0, elapsed), totalDuration)
        });
    }
}

function finishRoutine() {
    isPlaying = false;
    stopVoiceAndTick();

    silentPlayer.pause();
    bgMusicPlayer.pause();

    wordDisplay.innerText = i18n['finished'];
    playBtn.disabled = true;
    statusDiv.innerText = i18n['status_finished'];

    startedProtection = false;
    saveSelection();
}

function updateUI() {
    if (!isPlaying || !audioCtx || routineStartTime === 0) return;

    if (audioCtx.state === 'running') {
        const elapsed = audioCtx.currentTime - routineStartTime;
        currentTimeSpan.innerText = formatTime(Math.max(0, elapsed));
    }
    requestAnimationFrame(updateUI);
}

function formatTime(s) {
    const mins = Math.floor(s / 60);
    const secs = Math.floor(s % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

/*----------------------------------------------------------------------------------*/
function jump(direction) {
    if (!isPlaying) return;
    playHaptic();
    if (direction === 'next') playExercise(currentIndex + 1);
    else playExercise(currentIndex - 1);
}

if ('mediaSession' in navigator) {
    navigator.mediaSession.setActionHandler('play', () => playBtn.click());
    navigator.mediaSession.setActionHandler('pause', () => playBtn.click());
    navigator.mediaSession.setActionHandler('previoustrack', () => jump('prev'));
    navigator.mediaSession.setActionHandler('nexttrack', () => jump('next'));
}
/*----------------------------------------------------------------------------------*/

function saveSelection() {
    // selectedMoves ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— 'ropeFlowConfig'ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì €ì¥
    localStorage.setItem('ropeFlowConfig', JSON.stringify(selectedMoves));
    console.log("ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
}



function loadSelection() {
    const savedData = localStorage.getItem('ropeFlowConfig');
    if (savedData) {
        // ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì½ì–´ì™€ì„œ selectedMovesì— ë®ì–´ì“°ê¸°
        selectedMoves = JSON.parse(savedData);
        console.log("ì €ì¥ëœ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
    } else {
        // ì €ì¥ëœ ê²Œ ì—†ìœ¼ë©´ ëª¨ë“  ë™ì‘ì„ trueë¡œ ì´ˆê¸°í™” (ê¸°ì¡´ ë¡œì§)
        selectedMoves = {};
        Object.keys(VOICE_ASSETS).forEach(move => {
            if (move != 'tick') {
                selectedMoves[move] = true;
            }
        });
        console.log("selectedMoves ì´ˆê¸° ì„¤ì •ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.");
    }

    const savedGap = localStorage.getItem('gapTime');
    if (savedGap == null) {
        gapTime = DEFAULT_GAP_TIME;
        localStorage.setItem('gapTime', gapTime);
    }
    else {
        gapTime = parseInt(savedGap);
    }
    gapInput.value = gapTime;

    const savedVoiceVolume = localStorage.getItem('ropeFlowVoiceVol');
    if (savedVoiceVolume == null) {
        voiceVolume = DEFAULT_VOICE_VOLUME;
        localStorage.setItem('ropeFlowVoiceVol', voiceVolume);
    }
    else {
        voiceVolume = parseFloat(savedVoiceVolume);
    }
    voiceVolumeSlider.value = voiceVolume;
    console.log(voiceVolumeSlider.value);

    const savedBgVolume = localStorage.getItem('ropeFlowBgVol');
    if (savedBgVolume == null) {
        bgVolume = DEFAULT_BG_VOLUME;
        localStorage.setItem('ropeFlowBgVol', bgVolume);
    }
    else {
        bgVolume = parseFloat(savedBgVolume);
        console.log(bgVolume)
    }
    bgVolumeSlider.value = bgVolume;
    console.log(bgVolumeSlider.value);

    shuffledWords = Object.keys(selectedMoves).filter(m => selectedMoves[m]);
}

function applyLanguage() {
    // data-i18n ì†ì„±ì„ ê°€ì§„ ëª¨ë“  ìš”ì†Œë¥¼ ì°¾ì•„ í…ìŠ¤íŠ¸ë¥¼ êµì²´í•©ë‹ˆë‹¤.
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (i18n[key]) {
            el.innerText = i18n[key];
        }
    });

    // placeholderë‚˜ alert ë©”ì‹œì§€ë„ ì ìš©
    statusDiv.innerText = i18n['status_info'];
}

// ì•± ì‹¤í–‰ ì‹œ í˜¸ì¶œ
applyLanguage();

window.addEventListener('resize', resetHeight);
resetHeight();

// VOICE_ASSETSë¥¼ ë¶„ì„í•˜ì—¬ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ìë™ ë¶„ë¥˜
Object.keys(VOICE_ASSETS).forEach(moveName => {
    if (moveName == "tick") return;

    const groupName = VOICE_ASSETS[moveName].group;
    if (!MOVES_IN_GROUP_DB[groupName]) {
        MOVES_IN_GROUP_DB[groupName] = [];
    }
    MOVES_IN_GROUP_DB[groupName].push(moveName);
});

loadSelection();

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
// í™”ë©´ì¼œì§ ê´€ë ¨.
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
let wakeLock = null;
let keepScreenOn = localStorage.getItem('ropeFlowWakeLock') === 'true';

// 1. í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ë°˜ì˜
document.getElementById('wakeLockTick').checked = keepScreenOn;

// 2. í† ê¸€ ìŠ¤ìœ„ì¹˜ ë³€ê²½ ì´ë²¤íŠ¸
document.getElementById('wakeLockTick').addEventListener('change', (e) => {
    keepScreenOn = e.target.checked;
    localStorage.setItem('ropeFlowWakeLock', keepScreenOn);

    if (keepScreenOn) {
        requestWakeLock();
    }
    else {
        releaseWakeLock();
    }
});

// 3. í™”ë©´ ì¼œì§ ìœ ì§€ ìš”ì²­ í•¨ìˆ˜
async function requestWakeLock() {
    if (!keepScreenOn) return;
    
    try {
        if ('wakeLock' in navigator) {
            wakeLock = await navigator.wakeLock.request('screen');
            console.log('Wake Lock í™œì„±í™”ë¨');
        }
    } catch (err) {
        console.error('Wake Lock ì‹¤íŒ¨:', err);
    }
}

// 4. í™”ë©´ ì¼œì§ ìœ ì§€ í•´ì œ í•¨ìˆ˜
function releaseWakeLock() {
    if (wakeLock !== null) {
        wakeLock.release().then(() => {
            wakeLock = null;
            console.log('Wake Lock í•´ì œë¨');
        });
    }
}

// --- ê¸°ì¡´ ìš´ë™ ë¡œì§ì— ì—°ê²° ---
//function startWorkout() { // ìš´ë™ ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
//    // ... ê¸°ì¡´ ë¡œì§ ...
//    requestWakeLock();  //////////////// <-- ì‹¤ì œ ë£¨í‹´ ìœ„ì¹˜ì—ì„œ ì ìš©.
//}

// function stopWorkout() { // ìš´ë™ ì¢…ë£Œ/ì¤‘ë‹¨ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
//     // ... ê¸°ì¡´ ë¡œì§ ...
//     releaseWakeLock();<-- ì‹¤ì œ ë£¨í‹´ ìœ„ì¹˜ì—ì„œ ì ìš©.
// }

// 5. [ì¤‘ìš”] íƒ­ì„ ë‚˜ê°”ë‹¤ ë“¤ì–´ì™”ì„ ë•Œ ì¬í™œì„±í™”
// ë¸Œë¼ìš°ì €ëŠ” ë³´ì•ˆìƒ íƒ­ì´ ë³´ì´ì§€ ì•Šìœ¼ë©´ Wake Lockì„ ìë™ìœ¼ë¡œ í’‰ë‹ˆë‹¤.
document.addEventListener('visibilitychange', async () => {
    if (wakeLock !== null && document.visibilityState === 'visible') {
        await requestWakeLock();
    }
});


document.getElementById('toggle-volume').addEventListener('click', function() {
    console.log('toggle volume...');
    const controls = document.getElementById('volume-controls');
    controls.classList.toggle('collapsed');
    
    // ì•„ì´ì½˜ì„ ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´ (ì„ íƒ ì‚¬í•­)
    //this.innerText = controls.classList.contains('collapsed') ? 'ğŸ”¼' : 'ğŸ”½'; 
});

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
// 50ë¶„ ì•ŒëŒ ê¸°ëŠ¥ ê´€ë ¨.
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
let workoutStartTime = null;
let breakNotified = false;
let breakNotifyEnabled = localStorage.getItem('ropeFlowBreakNotify') === 'true';
let alarmTime = parseInt(localStorage.getItem('ropeFlowAlarmTime')) || 50;
// ì´ˆê¸° í™”ë©´ ì—…ë°ì´íŠ¸
alarmTimeSpan.innerText = alarmTime;

alarmTimeSpan.addEventListener('click', function() {
    // ì„ íƒì§€ ìƒì„± (20, 30, 40, 50, 60)
    const options = [1, 20, 30, 40, 50, 60];
    
    // ê°€ì¥ ê°„ë‹¨í•˜ê³  ì§ê´€ì ì¸ ë¸Œë¼ìš°ì € ê¸°ë³¸ ì„ íƒì°½(prompt) í˜¹ì€ 
    // ì»¤ìŠ¤í…€ UI ëŒ€ì‹  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¹ ë¥¸ ì„ íƒ ë¡œì§ì…ë‹ˆë‹¤.
    
    // ë°©ë²• A: ê°„ë‹¨í•œ prompt ì‚¬ìš© (ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì˜ì™¸ë¡œ í¸ë¦¬í•¨)
    /*
    let newTime = prompt("ì•ŒëŒ ì‹œê°„(ë¶„)ì„ ì„ íƒí•˜ì„¸ìš”: 20, 30, 40, 50, 60", alarmTime);
    if (newTime && options.includes(parseInt(newTime))) {
        updateAlarmTime(parseInt(newTime));
    }
    */

    // ë°©ë²• B: í´ë¦­í•  ë•Œë§ˆë‹¤ ìˆ«ìê°€ ìˆœí™˜í•˜ëŠ” ë°©ì‹ (UIê°€ ê¹”ë”í•¨)
    //*
    let currentIndex = options.indexOf(alarmTime);
    let nextIndex = (currentIndex + 1) % options.length;
    updateAlarmTime(options[nextIndex]);
    //*/

    // ë°©ë²• C: ìš”ì²­í•˜ì‹  '5ê°œ ì¤‘ í•˜ë‚˜ ì„ íƒ'ì„ ìœ„í•œ ê°„ë‹¨í•œ ì»¤ìŠ¤í…€ ì•Œë¦¼ì°½(ë˜ëŠ” ëª¨ë‹¬) ìƒì„±
    // ì—¬ê¸°ì„œëŠ” ê°€ì¥ ê¹”ë”í•œ 'ìˆœí™˜ ë°©ì‹'ì´ë‚˜ 'ê°„ë‹¨í•œ UI'ë¥¼ ì¶”ì²œë“œë¦¬ì§€ë§Œ, 
    // êµ¬ì²´ì ì¸ ì„ íƒì„ ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ë¡œì§ì„ ì œì•ˆí•©ë‹ˆë‹¤.
    
    //openTimePicker(options);
});

// ê°’ì„ ì„¤ì •í•˜ê³  ì €ì¥í•˜ëŠ” ê³µí†µ í•¨ìˆ˜
function updateAlarmTime(newVal) {
    alarmTime = newVal;
    alarmTimeSpan.innerText = alarmTime;
    localStorage.setItem('ropeFlowAlarmTime', alarmTime);
    console.log(`ì•ŒëŒ ì‹œê°„ì´ ${alarmTime}ë¶„ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

// ê°„ë‹¨í•œ ì„ íƒìš© UI (ì„ì‹œ ëª¨ë‹¬ ë°©ì‹)
function openTimePicker(options) {
    const overlay = document.createElement('div');
    overlay.style = "position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:1000;";
    
    const menu = document.createElement('div');
    menu.style = "background:white; padding:20px; border-radius:10px; text-align:center; color: #333";
    menu.innerHTML = "<p style='margin-bottom:15px; font-weight:bold;'>ì•ŒëŒ ì‹œê°„ ì„ íƒ (ë¶„)</p>";
    
    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.innerText = opt;
        btn.style = "margin: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; border: 1px solid #ddd; background: " + (opt === alarmTime ? "#007bff" : "#f8f9fa") + "; color: " + (opt === alarmTime ? "white" : "black");
        btn.onclick = () => {
            updateAlarmTime(opt);
            document.body.removeChild(overlay);
        };
        menu.appendChild(btn);
    });

    const cancelBtn = document.createElement('button');
    cancelBtn.innerText = "ì·¨ì†Œ";
    cancelBtn.style = "display:block; width:100%; margin-top:15px; padding:10px; border:none; background:#eee; cursor:pointer;";
    cancelBtn.onclick = () => document.body.removeChild(overlay);
    menu.appendChild(cancelBtn);

    overlay.appendChild(menu);
    document.body.appendChild(overlay);
}

// 1. ì„¤ì • ë¡œë“œ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.getElementById('breakNotifyTick').checked = breakNotifyEnabled;
document.getElementById('breakNotifyTick').addEventListener('change', (e) => {
    breakNotifyEnabled = e.target.checked;
    localStorage.setItem('ropeFlowBreakNotify', breakNotifyEnabled);
    if (breakNotifyEnabled) {
        requestNotificationPermission(); // ê¶Œí•œ ìš”ì²­

        if(audioCtx) { // ì•±ì„ ì‹¤í–‰í•œ í›„ì—, ì•„ì§ shuffle&startë¥¼ ì•ˆëˆ„ë¥¸ ìƒíƒœë©´, audioContxtê°€ nullì´ë‹¤.
            // ì´í›„ ì…”ì¸¨/ì‹œì‘ í•œí›„ ì¬ìƒ/ì •ì§€ë¥¼ ë°˜ë³µí•œ ê²½ìš°ì—ëŠ” audioContextê°€ ê³„ì† ì¡´ì¬í•œë‹¤.
            console.log('isPlaying?' + audioCtx.state);
            startAlarm();
        }
    }
    else {
        alarmTimeSpan.innerText = alarmTime;
        workoutStartTime = null;
    }
});

// 2. ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ í•¨ìˆ˜
function requestNotificationPermission() {
    if (!("Notification" in window)) return;
    if (Notification.permission !== "granted") {
        Notification.requestPermission();
    }
}

// 3. 50ë¶„ ì²´í¬ í•¨ìˆ˜ (1ë¶„ë§ˆë‹¤ ì‹¤í–‰)
function checkBreakTime() {
    if (!workoutStartTime || !breakNotifyEnabled || breakNotified) return;

    const now = Date.now();
    const elapsedMinutes = (now - workoutStartTime) / (1000 * 60);

    const leftAlarmTime = alarmTime - parseInt(elapsedMinutes);

    alarmTimeSpan.innerText = leftAlarmTime; //formatTime((now - workoutStartTime)/1000);


    if (elapsedMinutes >= alarmTime) {
        alarmTimeSpan.innerText = alarmTime;

        audioCtx.suspend();
        bgMusicPlayer.pause();
        silentPlayer.pause();

        playBtn.innerText = i18n['play_or_pause'];
        playBtn.disabled = true;

        breakNotified = false; //reset.
        triggerBreakAlert();

        breakNotified = true; // í•œ ë²ˆë§Œ ì•Œë¦¼
    } else {
        // ì•„ì§ 50ë¶„ì´ ì•ˆ ëìœ¼ë©´ 1ë¶„ ë’¤ ë‹¤ì‹œ ì²´í¬
        setTimeout(checkBreakTime, 60000);
        //setTimeout(checkBreakTime, 1000);
    }
}

let breakAudio = new Audio('alarm-327234.mp3'); 

// 4. ì‹¤ì œ ì•Œë¦¼ ë°œìƒ (ì†Œë¦¬ + ì‹œìŠ¤í…œ ì•Œë¦¼)
function triggerBreakAlert() {
    // A. ì‹œìŠ¤í…œ ì•Œë¦¼ì°½ ë„ìš°ê¸°
    if (Notification.permission === "granted") {
            const title = "RopeFlow íœ´ì‹ ì‹œê°„";
            const options = {
                body: "ë²Œì¨ 50ë¶„ê°„ ìš´ë™í•˜ì…¨ë„¤ìš”! 10ë¶„ê°„ íœ´ì‹í•˜ì„¸ìš”.",
                icon: "icon-192.png",
                vibrate: [200, 100, 200], // ì•ˆë“œë¡œì´ë“œ ì§„ë™ ì¶”ê°€
                tag: 'break-alert' // ë™ì¼ íƒœê·¸ ì•Œë¦¼ì€ í•˜ë‚˜ë¡œ ë¬¶ì–´ì¤Œ (ì¤‘ë³µ ë°©ì§€)
            };

            // 1. ì„œë¹„ìŠ¤ ì›Œì»¤ ë°©ì‹ ì‹œë„ (PWA/ëª¨ë°”ì¼ìš©)
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification(title, options);
                });
            } 
            // 2. ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ ì—†ëŠ” ì¼ë°˜ ë¸Œë¼ìš°ì € í™˜ê²½ìš©
            else {
                new Notification(title, options);
            }
    } else if (Notification.permission !== "denied") {
        // ê¶Œí•œì´ ì—†ë‹¤ë©´ ë‹¤ì‹œ ìš”ì²­ (ìµœì´ˆ 1íšŒ)
        Notification.requestPermission().then(permission => {
            if (permission === "granted") triggerBreakAlert();
        });
    }

    // B. ì•ˆë‚´ ìŒì„± ì¬ìƒ (ê¸°ì¡´ ì˜¤ë””ì˜¤ ê°ì²´ í™œìš© í˜¹ì€ ìƒˆ ê°ì²´)
    // ë³„ë„ì˜ 'íœ´ì‹ ì•ˆë‚´' mp3ê°€ ìˆë‹¤ë©´ ê·¸ íŒŒì¼ì„ ì¬ìƒí•©ë‹ˆë‹¤.
    
    breakAudio.volume = document.getElementById('bgVol').value; // ê¸°ì¡´ BGM ë³¼ë¥¨ê°’ ì ìš©
    breakAudio.play().catch(e => console.log("ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:", e));
    
    // ì•Œë¦¼ í›„ í™”ë©´ì— ë©”ì‹œì§€ í‘œì‹œ (ì„ íƒ ì‚¬í•­)
    //alert("50ë¶„ ê²½ê³¼! ì ì‹œ íœ´ì‹í•˜ì„¸ìš”.");

    endAlarm();
}

// --- ê¸°ì¡´ ìš´ë™ ì‹œì‘/ì¢…ë£Œ í•¨ìˆ˜ì— ì—°ê²° ---

function startAlarm() {
    workoutStartTime = Date.now();
    breakNotified = false;
    if (breakNotifyEnabled) {
        console.log('startAlarm-----------');
        checkBreakTime();
    }
}

function endAlarm() {
    workoutStartTime = null;
}

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
// ë’¤ë¡œê°€ê¸°/ìƒˆë¡œê³ ì¹¨ ë“±ìœ¼ë¡œ ì˜¤ë””ì˜¤ì¬ìƒì´ ëŠê¹€ì„ ë°©ì§€.
// ì‹œì‘í•  ë•Œ ë‘ ì¥ì¹˜ë¥¼ ëª¨ë‘ ì¼­ë‹ˆë‹¤.
let isWorkoutRunning = false;
let startedProtection = false;

function startProtection() {
    isWorkoutRunning = true;
    startedProtection = true;
    // 1. íƒ­ ë‹«ê¸°/ìƒˆë¡œê³ ì¹¨ ë°©ì§€
    window.onbeforeunload = (e) => {
        if (isWorkoutRunning) {
            // í˜„ëŒ€ì ì¸ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ì§€ì •í•´ë„ í‘œì¤€ ë¬¸êµ¬ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.
            e.preventDefault();
            e.returnValue = ''; 
        }
    }; 
    
    // 2. ë’¤ë¡œê°€ê¸° ë°©ì§€
    history.pushState(null, null, location.href);
    window.onpopstate = () => {
        if (isWorkoutRunning) {
            if (confirm("ìš´ë™ì„ ì¤‘ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                isWorkoutRunning = false;
                history.back();
            } else {
                history.pushState(null, null, location.href);
            }
        }
    };
}

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

// PWA ë“±ë¡.
if ('serviceWorker' in navigator) {
    try {
      navigator.serviceWorker.register('service-worker.js');
    }
    catch (err) {
        console.error('service-worker.js register ì‹¤íŒ¨:', err);
    }
}
</script>
</body>
</html>
